<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>JINSUL - Professional Consulting System</title>
    <style>
        :root { --blue: #0052cc; --gray: #f4f5f7; --text: #172b4d; }
        body { font-family: 'Pretendard', sans-serif; margin: 0; background: #fafbfc; color: var(--text); }
        header { background: white; padding: 20px; border-bottom: 1px solid #ddd; text-align: center; }
        .container { max-width: 1100px; margin: 30px auto; padding: 0 20px; }
        .card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* Dashboard Styling */
        .dashboard { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        .target-box { background: var(--blue); color: white; padding: 30px; border-radius: 15px; text-align: center; }
        .target-input { font-size: 2.5em; width: 180px; background: none; border: none; border-bottom: 3px solid white; color: white; text-align: right; outline: none; font-weight: 800; }
        
        /* Table Styling */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: var(--gray); padding: 12px; text-align: left; font-size: 0.85em; }
        td { padding: 10px; border-bottom: 1px solid #eee; }
        input[type="number"], input[type="text"] { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        
        .btn { padding: 12px 25px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--blue); color: white; width: 100%; font-size: 1.1em; }
        .status { font-size: 0.9em; color: #666; margin-top: 10px; text-align: center; }
        .result-area { font-size: 3em; font-weight: 900; color: #d73a49; }
        .lock-btn { background: none; border: none; cursor: pointer; font-size: 1.2em; opacity: 0.5; }
        .lock-btn.active { opacity: 1; color: red; }
    </style>
</head>
<body>

<header>
    <h1 style="margin:0; font-size: 1.5em; letter-spacing: -1px;">JINSUL CONSULTING</h1>
    <div id="loadingStatus" class="status">ë°ì´í„° ë¡œë”© ì¤‘... (GitHub ì—°ê²° ì¤‘)</div>
</header>

<div class="container">
    <div class="dashboard">
        <div>
            <div class="card">
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <select id="bundleSelect" style="flex:1; padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-weight: 700;">
                        <option value="">-- ë¬¶ìŒì½”ë“œë¥¼ ì„ íƒí•˜ì„¸ìš” (ìµœì‹  ì²˜ë°©ì„¸íŠ¸) --</option>
                    </select>
                    <button class="btn" onclick="loadBundle()" style="background: #ebecf0;">ì„¸íŠ¸ ë¡œë“œ</button>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th style="width:15%">ì½”ë“œ</th>
                            <th>í•­ëª©ëª…</th>
                            <th style="width:15%">ë‹¨ê°€</th>
                            <th style="width:10%">ìˆ˜ëŸ‰</th>
                            <th style="width:8%">ê³ ì •</th>
                        </tr>
                    </thead>
                    <tbody id="itemList">
                        </tbody>
                </table>
                <button class="btn btn-primary" style="margin-top:20px;" onclick="autoBalance()">ìë™ ì—­ì‚° ì‹¤í–‰ (Goal Seek)</button>
            </div>
        </div>

        <div>
            <div class="target-box">
                <div style="opacity:0.8; margin-bottom:10px;">ğŸ¯ ëª©í‘œ ìˆ˜ë‚©ì•¡</div>
                <div><input type="number" id="targetPrice" class="target-input" value="89000"> ì›</div>
                <div style="margin-top:20px;">
                    <select id="seniorMode" onchange="calculate()" style="padding: 5px; border-radius: 5px;">
                        <option value="normal">ì¼ë°˜ ì™¸ë˜ (30%)</option>
                        <option value="senior">ë…¸ì¸ (65ì„¸ ì´ìƒ)</option>
                    </select>
                </div>
            </div>

            <div class="card" style="text-align: center; margin-top: 20px;">
                <div style="color: #666; font-size: 0.9em;">í˜„ì¬ í™˜ì ìˆ˜ë‚©ì•¡</div>
                <div id="finalPayment" class="result-area">0 ì›</div>
                <hr>
                <div style="text-align: left; font-size: 0.85em; line-height: 1.6;">
                    â€¢ ë³¸ì¸ë¶€ë‹´ê¸ˆ: <span id="benefitPay">0</span>ì›<br>
                    â€¢ ë¹„ê¸‰ì—¬ ì´ì•¡: <span id="nonBenefitPay">0</span>ì›
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 1. ì €ì¥ì†Œ ì´ë¦„ ìˆ˜ì • (opneteam -> openteam)
    const REPO_BASE = "https://raw.githubusercontent.com/jinsul-lab/openteam/main/";
    
    const MASTER_FILES = [
        "ì˜ì¹˜ê³¼ìˆ˜ê°€(20260103).csv", 
        "ì•½ê°€(20260101).csv",
        "ì¹˜ë£Œì¬ë£ŒëŒ€(20251201).csv"
    ];
    const BUNDLE_FILE = "code.xls - sheet.csv";

    let masterDB = {};
    let bundles = {};

    async function init() {
        const statusEl = document.getElementById('loadingStatus');
        try {
            statusEl.innerText = "ğŸš€ GitHub ì„œë²„ì—ì„œ ë§ˆìŠ¤í„° ë°ì´í„°ë¥¼ ë™ê¸°í™” ì¤‘...";
            
            // í•œê¸€ ê¹¨ì§ ë°©ì§€ë¥¼ ìœ„í•´ ì¸ì½”ë”© ì²˜ë¦¬(EUC-KR) í¬í•¨ ë¡œë“œ
            for (const file of MASTER_FILES) {
                await loadCSV(file);
            }
            await loadBundleCSV(BUNDLE_FILE);

            statusEl.innerText = `âœ… ë¡œë“œ ì™„ë£Œ: ìˆ˜ê°€(${Object.keys(masterDB).length}ê±´), ì„¸íŠ¸(${Object.keys(bundles).length}ê±´)`;
            renderBundleOptions();
        } catch (e) {
            console.error(e);
            statusEl.innerText = "âŒ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨! (íŒŒì¼ ì´ë¦„ì´ë‚˜ ëŒ€ì†Œë¬¸ìë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”)";
        }
    }

    async function loadCSV(fileName) {
        const res = await fetch(REPO_BASE + encodeURIComponent(fileName));
        if (!res.ok) throw new Error(`${fileName}ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        
        // í•µì‹¬: í•œê¸€ ê¹¨ì§ ë°©ì§€ë¥¼ ìœ„í•œ ë””ì½”ë” ì‚¬ìš©
        const arrayBuffer = await res.arrayBuffer();
        const decoder = new TextDecoder('euc-kr');
        const text = decoder.decode(arrayBuffer);
        
        const rows = text.split('\n').slice(1);
        rows.forEach(row => {
            const cols = row.split(',');
            const id = cols[0]?.trim().toUpperCase();
            if(id) {
                masterDB[id] = {
                    name: cols[3] || cols[1] || "ëª…ì¹­ ì—†ìŒ",
                    price: parseInt(cols[7]) || parseInt(cols[4]) || 0,
                    type: row.includes('ë¹„ê¸‰ì—¬') ? 'nonbenefit' : 'benefit'
                };
            }
        });
    }

    async function loadBundleCSV(fileName) {
        const res = await fetch(REPO_BASE + encodeURIComponent(fileName));
        const arrayBuffer = await res.arrayBuffer();
        const decoder = new TextDecoder('euc-kr');
        const text = decoder.decode(arrayBuffer);
        
        const rows = text.split('\n').slice(1);
        rows.forEach(row => {
            const cols = row.split(',');
            const bCode = cols[0]?.trim();
            if(bCode && bCode !== "") {
                if(!bundles[bCode]) bundles[bCode] = { name: cols[1], items: [] };
                const subCode = cols[3]?.trim().toUpperCase();
                if(subCode && subCode !== "ID" && subCode !== "í•˜ìœ„ì½”ë“œ") {
                    bundles[bCode].items.push({
                        code: subCode,
                        name: cols[4],
                        qty: parseFloat(cols[5]) || 1,
                        type: cols[9]?.includes('ë¹„ê¸‰ì—¬') ? 'nonbenefit' : 'benefit'
                    });
                }
            }
        });
    }
    // ... (ì´í›„ ë Œë”ë§ ë° ê³„ì‚° í•¨ìˆ˜ëŠ” ë™ì¼)
</script>
</body>
</html>
